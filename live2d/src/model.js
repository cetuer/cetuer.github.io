import showMessage from"./message.js";import randomSelection from"./utils.js";class Model{constructor(e){let{apiPath:t,cdnPath:s}=e,o=!1;if("string"==typeof s)o=!0,s.endsWith("/")||(s+="/");else{if("string"!=typeof t)throw"Invalid initWidget argument!";t.endsWith("/")||(t+="/")}this.useCDN=o,this.apiPath=t,this.cdnPath=s}async loadModelList(){var e=await fetch(this.cdnPath+"model_list.json");this.modelList=await e.json()}async loadModel(e,t,s){localStorage.setItem("modelId",e),localStorage.setItem("modelTexturesId",t),showMessage(s,4e3,10),this.useCDN?(this.modelList||await this.loadModelList(),s=randomSelection(this.modelList.models[e]),loadlive2d("live2d",this.cdnPath+`model/${s}/index.json`)):(loadlive2d("live2d",this.apiPath+`get/?id=${e}-`+t),console.log(`Live2D 模型 ${e}-${t} 加载完成`))}async loadRandModel(){const t=localStorage.getItem("modelId"),s=localStorage.getItem("modelTexturesId");var e;this.useCDN?(this.modelList||await this.loadModelList(),e=randomSelection(this.modelList.models[t]),loadlive2d("live2d",this.cdnPath+`model/${e}/index.json`),showMessage("我的新衣服好看嘛？",4e3,10)):fetch(`${this.apiPath}rand_textures/?id=${t}-`+s).then(e=>e.json()).then(e=>{1!==e.textures.id||1!==s&&0!==s?this.loadModel(t,e.textures.id,"我的新衣服好看嘛？"):showMessage("我还没有其他衣服呢！",4e3,10)})}async loadOtherModel(){let e=localStorage.getItem("modelId");var t;this.useCDN?(this.modelList||await this.loadModelList(),t=++e>=this.modelList.models.length?0:e,this.loadModel(t,0,this.modelList.messages[t])):fetch(this.apiPath+"switch/?id="+e).then(e=>e.json()).then(e=>{this.loadModel(e.model.id,0,e.model.message)})}}export default Model;