import Model from"./model.js";import showMessage from"./message.js";import randomSelection from"./utils.js";import tools from"./tools.js";function loadWidget(o){const a=new Model(o);localStorage.removeItem("waifu-display"),sessionStorage.removeItem("waifu-text"),document.body.insertAdjacentHTML("beforeend",`<div id="waifu">
            <div id="waifu-tips"></div>
            <canvas id="live2d" width="800" height="800"></canvas>
            <div id="waifu-tool"></div>
        </div>`),setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0),tools["switch-model"].callback=()=>a.loadOtherModel(),tools["switch-texture"].callback=()=>a.loadRandModel(),Array.isArray(o.tools)||(o.tools=Object.keys(tools));for(var e of o.tools){var t,i;tools[e]&&({icon:t,callback:i}=tools[e],document.getElementById("waifu-tool").insertAdjacentHTML("beforeend",`<span id="waifu-tool-${e}">${t}</span>`),document.getElementById("waifu-tool-"+e).addEventListener("click",i))}function s(a){let e=!1,t,i=a.message.default;window.addEventListener("mousemove",()=>e=!0),window.addEventListener("keydown",()=>e=!0),setInterval(()=>{t=e?(e=!1,clearInterval(t),null):t||setInterval(()=>{showMessage(i,6e3,9)},2e4)},1e3),showMessage(function(e){if("/"===location.pathname)for(var{hour:t,text:o}of e){var a=new Date,i=t.split("-")[0],t=t.split("-")[1]||i;if(i<=a.getHours()&&a.getHours()<=t)return o}var s,n,l,e=`欢迎阅读<span>「${document.title.split(" - ")[0]}」</span>`;let d;return""===document.referrer||(n=(s=new URL(document.referrer)).hostname.split(".")[1],l={baidu:"百度",so:"360搜索",google:"谷歌搜索"},location.hostname===s.hostname)?e:`Hello！来自 <span>${d=n in l?l[n]:s.hostname}</span> 的朋友<br>`+e}(a.time),7e3,11),window.addEventListener("mouseover",e=>{for(var{selector:t,text:o}of a.mouseover)if(e.target.matches(t))return o=(o=randomSelection(o)).replace("{text}",e.target.innerText),void showMessage(o,4e3,8)}),window.addEventListener("click",e=>{for(var{selector:t,text:o}of a.click)if(e.target.matches(t))return o=(o=randomSelection(o)).replace("{text}",e.target.innerText),void showMessage(o,4e3,8)}),a.seasons.forEach(({date:e,text:t})=>{var o=new Date,a=e.split("-")[0],e=e.split("-")[1]||a;a.split("/")[0]<=o.getMonth()+1&&o.getMonth()+1<=e.split("/")[0]&&a.split("/")[1]<=o.getDate()&&o.getDate()<=e.split("/")[1]&&(t=(t=randomSelection(t)).replace("{year}",o.getFullYear()),i.push(t))});var o=()=>{};console.log("%c",o),o.toString=()=>{showMessage(a.message.console,6e3,9)},window.addEventListener("copy",()=>{showMessage(a.message.copy,6e3,9)}),window.addEventListener("visibilitychange",()=>{document.hidden||showMessage(a.message.visibilitychange,6e3,9)})}{let e=localStorage.getItem("modelId"),t=localStorage.getItem("modelTexturesId");null===e&&(e=1,t=53),a.loadModel(e,t),fetch(o.waifuPath).then(e=>e.json()).then(s)}}function initWidget(e,t){"string"==typeof e&&(e={waifuPath:e,apiPath:t}),document.body.insertAdjacentHTML("beforeend",`<div id="waifu-toggle">
            <span>看板娘</span>
        </div>`);const o=document.getElementById("waifu-toggle");o.addEventListener("click",()=>{o.classList.remove("waifu-toggle-active"),o.getAttribute("first-time")?(loadWidget(e),o.removeAttribute("first-time")):(localStorage.removeItem("waifu-display"),document.getElementById("waifu").style.display="",setTimeout(()=>{document.getElementById("waifu").style.bottom=0},0))}),localStorage.getItem("waifu-display")&&Date.now()-localStorage.getItem("waifu-display")<=864e5?(o.setAttribute("first-time",!0),setTimeout(()=>{o.classList.add("waifu-toggle-active")},0)):loadWidget(e)}export default initWidget;